kind: Deployment
replicaCount: 2

service:
  type: LoadBalancer
  annotations:
    metallb.universe.tf/loadBalancerIPs: 139.229.134.85

extraPorts:
  - name: syslog-tcp
    port: 514
    containerPort: 514
    protocol: TCP
  - name: syslog-udp
    port: 514
    containerPort: 514
    protocol: UDP
  - name: http-input
    port: 9880
    containerPort: 9880
    protocol: TCP

config:
  service: |
    [SERVICE]
        Daemon       off
        Flush        1
        Log_Level    info
        Parsers_File /fluent-bit/etc/parsers.conf
        HTTP_Server  On
        HTTP_Listen  0.0.0.0
        HTTP_Port    2020
        Health_Check On

  # Inputs: listen for syslog over TCP and UDP on port 514 and JSON logs via HTTP
  inputs: |
    [INPUT]
        Name   syslog
        Listen 0.0.0.0
        Port   514
        Mode   tcp
        Tag    syslog.tcp

    [INPUT]
        Name   syslog
        Listen 0.0.0.0
        Port   514
        Mode   udp
        Tag    syslog.udp

    [INPUT]
        Name   http
        Listen 0.0.0.0
        Port   9880
        Format json
        Tag    http

  outputs: |
    [OUTPUT]
        Name  loki
        Match *
        Host  loki-distributor.loki.svc.cluster.local
        Port  3100
        Label_Keys $host,$tag
        Line_Format json
        # Add TLS or authentication here if needed (not shown for brevity)
