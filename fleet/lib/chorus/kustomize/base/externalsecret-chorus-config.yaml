---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: chorus-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  data:
    - secretKey: RUKA_AWS_ACCESS_KEY_ID
      remoteRef:
        key: chorus-ruka
        property: AWS_ACCESS_KEY_ID
    - secretKey: RUKA_AWS_SECRET_ACCESS_KEY
      remoteRef:
        key: chorus-ruka
        property: AWS_SECRET_ACCESS_KEY
  target:
    template:
      data:
        config: |
          storage:
            createReplication: true
            createRouting: true
            defaultRegion: us-east-1
            storages:
              gaw:
                address: s3.gaw.ls.lsst.org
                defaultRegion: k8up-backups
                isSecure: true
                provider: Ceph
                credentials:
                  user1:
                    accessKeyID: "{{ .RUKA_AWS_ACCESS_KEY_ID }}"
                    secretAccessKey: "{{ .RUKA_AWS_SECRET_ACCESS_KEY }}"
              ruka:
                address: s3.ruka.dev.lsst.org
                defaultRegion: lfa
                isMain: true
                isSecure: true
                provider: Ceph
                credentials:
                  user1:
                    accessKeyID: "{{ .RUKA_AWS_ACCESS_KEY_ID }}"
                    secretAccessKey: "{{ .RUKA_AWS_SECRET_ACCESS_KEY }}"
